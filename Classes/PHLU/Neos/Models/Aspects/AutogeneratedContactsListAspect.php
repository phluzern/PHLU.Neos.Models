<?php

namespace PHLU\Neos\Models\Aspects;


use PHLU\Evento\Service\Contact\ImportService;
use Neos\Flow\Annotations as Flow;
use Neos\Flow\Aop\JoinPointInterface;

/**
 * @Flow\Scope("singleton")
 * @Flow\Aspect
 */
class AutogeneratedContactsListAspect
{


    /**
     * @Flow\Inject
     * @var ImportService
     */
    protected $importService;

    /**
     * @Flow\Before("within(Neos\ContentRepository\Domain\Repository\NodeDataRepository) && method(public .+->(update|add)(object.nodeType.name == 'PHLU.Corporate:SectionAutoGeneratedContentContactsList'))")
     * @return void
     */
    public function update(JoinPointInterface $joinPoint)
    {


        $object = $joinPoint->getMethodArgument('object');
        /* @var \Neos\ContentRepository\Domain\Model\NodeData $object */
        $this->importService->updateAutogeneratedContactsListFromNodeData($object);


    }



}
